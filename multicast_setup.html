<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>LCM: UDP Multicast Setup</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LCM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">UDP Multicast Setup </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Getting maximum performance on your LAN or local host</p>
<h1><a class="anchor" id="multicast_single_host"></a>
Using LCM on a single host</h1>
<p>Since LCM uses UDP Multicast as a transport mechanism, a valid multicast route must always be defined. This means that to use LCM, even for inter-application communication on a single host, <em>you must have a multicast-enabled network interface</em>. If your computer is already connected to the Internet, LCM will generally "just work" because the default route will allow LCM to find the correct network interface for multicast traffic.</p>
<p>If your computer is not connected to any network, you may need to explicitly enable multicast traffic by adding multicast entries to your system's routing table. On Linux, you can setup the loopback interface for multicast with the following commands:</p>
<pre class="fragment">  sudo ifconfig lo multicast
  sudo route add -net 224.0.0.0 netmask 240.0.0.0 dev lo
</pre><p>Remember, you must always do this to use LCM if your machine is <em>not connected</em> to any external network.</p>
<h1><a class="anchor" id="multicast_multihost"></a>
Using LCM across multiple hosts</h1>
<h2><a class="anchor" id="multicast_ttl"></a>
Choosing a TTL</h2>
<p>LCM by default uses a time-to-live (TTL) value of 0. This will prevent any LCM packets from being transmitted on the wire. Only local applications will see them. Choose a value of 1 for the entire subnet to see the traffic. Even larger values will enable the packets to pass through routers. However, these routers must be set up with multicast routing tables in order to successfully relay multicast traffic.</p>
<p>There are two ways to set the TTL. First, LCM constructors in all languages provide a way to set the TTL (e.g. see <a class="el" href="group__LcmC__lcm__t.html#gaf29963ef43edadf45296d5ad82c18d4b" title="Constructor. ">lcm_create()</a>), so you can set this in your code. Second, if your program does not explicitly set its provider URL, then you can use the <code>LCM_DEFAULT_URL</code> environment variable. For exaple, in the bash shell: </p>
<pre class="fragment">  export LCM_DEFAULT_URL=udpm://239.255.76.67:7667?ttl=1
</pre><h2><a class="anchor" id="multicast_igmp"></a>
Using IGMP snooping</h2>
<p>When the multicast protocol was designed, it was intended that on local subnets it would act like broadcast traffic. However, for high-bandwidth applications, this may not be desirable since it will degrade the bandwidth available for hosts not participating in the multicast group.</p>
<p>Switch manufacturers have come up with a solution to this problem called "IGMP
snooping". IGMP snooping consists of two parts. First, the switch must monitor network traffic across its ports and decode any IGMP packets that deal with multicast group subscriptions. The switch can then send multicast traffic for a particular group only to those ports where a subscription request has been observed. The second part is IGMP querying. Hosts will only send out subscription requests upon first subscribing or when queried by a router. In order for the switch to maintain its state, these queries must be sent every few minutes. If there is no router on your subnet sending these queries, you must configure the switch to send out "fake queries". Without this, the hosts will eventually stop sending IGMP subscription requests, and the switch will "fail open" causing all multicast traffic to be broadcast again.</p>
<h2><a class="anchor" id="multicast_firewalls"></a>
Firewalls</h2>
<p>If your operating system is running a firewall, then be sure to check its settings and make sure that it is allowing UDP Multicast traffic to get through. Specifically, make sure the incoming packets are allowed on the multicast group and port you're using (defined in the LCM URL). The exact method of doing this depends heavily on the specific firewall software installed, so general instructions can't be given here.</p>
<h2><a class="anchor" id="multicast_mixed_speed"></a>
Mixed-speed networks</h2>
<p>If you have a subnet with devices of different speeds, such as 10Mbps links mixed with 100Mbps links, be extra careful using multicast. LCM traffic will be sent to all devices (unless you enable IGMP snooping, above). If two 100Mbps devices are exchanging more than 10Mbps of traffic, this traffic will be relayed to the slow device by the switch, even if that device does not run LCM. This can overwhelm the bandwidth of that link, and depending on the switch, may even cause back pressure on the 100Mbps devices. That means, not only will the 10Mbps link be swamped, but the 100Mbps devices will be unable to transmit faster than 10Mbps because their send queues will start filling up and cause blocking writes in the LCM API.</p>
<p>The easiest solution to this problem is to enable IGMP snooping, as described above. If that is not available, sometimes it is sufficient to upgrade from consumer-grade switches to managed switches, which often have better buffering strategies. As a last resort, separating the slow devices from high-speed devices using two levels of switches can also improve the situation.</p>
<h1><a class="anchor" id="multicast_kernel_buffer"></a>
Kernel UDP receive buffer sizing</h1>
<p>When used on a properly shielded local area network, the most common source of dropped and lost packets is not electrical disturbances. Instead, it will usually be packet buffers that have reached capacity and cannot store any more packets.</p>
<p>Operating system kernels typically allocate both a <em>send buffer</em> and <em>receive buffer</em> for a network socket. The send buffer stores packets that the operating system has agreed to transmit (i.e. a call to <code>send()</code> was successful) but that it hasn't actually yet transmitted over the network. The receive buffer stores packets that the operating system has received from the network, but that the application hasn't yet retrieved. In both cases, the buffers have a maximum capacity, and no new packets can be sent or received if that capacity is reached. In the send case, a call to <code>send()</code> blocks until there is space in the buffer (or fails with <code>EAGAIN</code> for non-blocking sockets). In the receive case, incoming packets are simply discarded.</p>
<p>When LCM is used in a high-bandwidth application, it may become necessary to increase both the default and the maximum kernel receive buffer size to avoid dropped packets.</p>
<p>Configuring the kernel can be done without rebooting, but requires superuser privileges. The following table demonstrates how to do this and set a 2MB maximum buffer size.</p>
<table class="doxtable">
<tr>
<th>OS</th><th>Maximum</th><th>Default </th></tr>
<tr>
<td>Linux </td><td><code>sysctl -w net.core.rmem_max=2097152</code> </td><td><code>sysctl -w net.core.rmem_default=2097152</code> </td></tr>
<tr>
<td>OS/X, FreeBSD, etc. </td><td><code>sysctl -w kern.ipc.maxsockbuf=2097152</code> </td><td>??  </td></tr>
</table>
<p>Most GNU/Linux distributions also allow setting these permanently using the file <code>/etc/sysctl.conf</code>. To do this, add the following lines into the file somewhere:</p>
<pre class="fragment">    net.core.rmem_max=2097152
    net.core.rmem_default=2097152
</pre><p>Note that OS/X users may need to increase the incoming (<code>net.inet.udp.recvspace</code>) and outgoing (<code>net.inet.udp.maxdgram</code>) datagram sizes in order to send larger messages. This can be done with the following commands:</p>
<pre class="fragment">    sysctl -w net.inet.udp.recvspace=209715
    sysctl -w net.inet.udp.maxdgram=65500
</pre><p>In our initial projects, which involved typical data rates of 10 MB/s, a 2 MB receive buffer was generally sufficient.</p>
<dl class="section note"><dt>Note</dt><dd><a href="http://www.29west.com/docs/THPM/udp-buffer-sizing.html">http://www.29west.com/docs/THPM/udp-buffer-sizing.html</a> is also a good source of information on UDP buffer sizing.</dd></dl>
<h1><a class="anchor" id="multicast_firewalls"></a>
Firewalls</h1>
<p>Systems with overzealous firewalls may prevent UDP multicast traffic from reaching an LCM process. If you are having trouble receiving messages across the network, check your firewall settings. </p>
</div></div><!-- contents -->
<hr class="footer"/></body>
</html>
