<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>LCM: C Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LCM
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">C Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Sending and receiving LCM messages with C</p>
<h1><a class="anchor" id="tutorial_c_intro"></a>
Introduction</h1>
<p>This tutorial will walk you through the main tasks for exchanging messages using the LCM C API. It covers the following topics:</p>
<ul>
<li>Initialize LCM in your application. </li>
<li>Publish a message. </li>
<li>Subscribe to and receive a message.</li>
</ul>
<p>This tutorial uses the <code>example_t</code> message type defined in the <a class="el" href="tut_lcmgen.html">type definition tutorial</a>, and assumes that you have generated the C bindings for the example type by running </p>
<div class="fragment"><div class="line">lcm-gen -c example_t.lcm</div>
</div><!-- fragment --><p>After running this command, you should have two files: <code>exlcm_example_t.c</code> and <code>exlcm_example_t.h</code>. These two files are the C bindings for the example message type. Notice that the message type package name "exlcm" was prepended to the file name. This is how LCM emulates namespaces in C, and the package name is also prefixed to the generated C struct name. If you have the time, take a moment to open up those two files and inspect the generated code.</p>
<h1><a class="anchor" id="tutorial_c_initialize"></a>
Initializing LCM</h1>
<p>The first task for any application that uses LCM is to initialize the library. Here's an example of that (and how to clean up after itself as well):</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;lcm/lcm.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__LcmC__lcm__t.html#gabb730c9e49442a4bcf400e0f2fef7576">lcm_t</a> * lcm = <a class="code" href="group__LcmC__lcm__t.html#gaf29963ef43edadf45296d5ad82c18d4b">lcm_create</a>(NULL);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(!lcm)</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Your application goes here */</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__LcmC__lcm__t.html#ga4c86753e2e8c535bc8fb91d3763336e2">lcm_destroy</a>(lcm);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The function <a class="el" href="group__LcmC__lcm__t.html#gaf29963ef43edadf45296d5ad82c18d4b" title="Constructor. ">lcm_create()</a> allocates and initializes an instance of <a class="el" href="group__LcmC__lcm__t.html#gabb730c9e49442a4bcf400e0f2fef7576">lcm_t</a>, which represents a connection to an LCM network. The single argument can be <code>NULL</code> as shown above, to initialize LCM with default settings. The defaults initialized are suitable for communicating with other LCM applications on the local computer. The argument can also be a string specifying the underlying communications mechanisms. For communication across computers, or other usages such as reading data from an LCM logfile (e.g., to post-process or analyze previously collected data), see the API reference for <a class="el" href="group__LcmC__lcm__t.html#gaf29963ef43edadf45296d5ad82c18d4b" title="Constructor. ">lcm_create()</a>.</p>
<p>Once you're all done, it's a good idea to call <a class="el" href="group__LcmC__lcm__t.html#ga4c86753e2e8c535bc8fb91d3763336e2" title="Destructor. ">lcm_destroy()</a> to clean up any resources used by LCM.</p>
<h1><a class="anchor" id="tutorial_c_publishing"></a>
Publishing a message</h1>
<p>When you create an LCM data type and generate C code with <code>lcm-gen</code>, that data type will then be available as a C struct with the same name. For <code>example_t</code>, the C struct that gets generated looks like this:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>_exlcm_example_t exlcm_example_t;</div>
<div class="line"><span class="keyword">struct </span>_exlcm_example_t</div>
<div class="line">{</div>
<div class="line">    int64_t    timestamp;</div>
<div class="line">    <span class="keywordtype">double</span>     position[3];</div>
<div class="line">    <span class="keywordtype">double</span>     orientation[4];</div>
<div class="line">    int32_t    num_ranges;</div>
<div class="line">    int16_t    *ranges;</div>
<div class="line">    <span class="keywordtype">char</span>*      name;</div>
<div class="line">    int8_t     enabled;</div>
<div class="line">};</div>
</div><!-- fragment --><p>Notice here that fixed-length arrays in LCM appear as fixed-length C arrays. Variable length arrays appear as pointers in C. More on that below.</p>
<p>We can instantiate and then publish some sample data as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;lcm/lcm.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;exlcm_example_t.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__LcmC__lcm__t.html#gabb730c9e49442a4bcf400e0f2fef7576">lcm_t</a> * lcm = <a class="code" href="group__LcmC__lcm__t.html#gaf29963ef43edadf45296d5ad82c18d4b">lcm_create</a>(NULL);</div>
<div class="line">    <span class="keywordflow">if</span>(!lcm)</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line"></div>
<div class="line">    exlcm_example_t my_data = {</div>
<div class="line">        .timestamp = 0,</div>
<div class="line">        .position = { 1, 2, 3 },</div>
<div class="line">        .orientation = { 1, 0, 0, 0 },</div>
<div class="line">    };</div>
<div class="line">    int16_t ranges[15];</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    <span class="keywordflow">for</span>(i = 0; i &lt; 15; i++)</div>
<div class="line">        ranges[i] = i;</div>
<div class="line"></div>
<div class="line">    my_data.num_ranges = 15;</div>
<div class="line">    my_data.ranges = ranges;</div>
<div class="line">    my_data.name = <span class="stringliteral">&quot;example string&quot;</span>;</div>
<div class="line">    my_data.enabled = 1;</div>
<div class="line"></div>
<div class="line">    exlcm_example_t_publish(lcm, <span class="stringliteral">&quot;EXAMPLE&quot;</span>, &amp;my_data);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__LcmC__lcm__t.html#ga4c86753e2e8c535bc8fb91d3763336e2">lcm_destroy</a>(lcm);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The full example is available in runnable form as <code>examples/c/send_message.c</code> in the LCM source distribution.</p>
<p>For the most part, this example should be pretty straightforward. Note that <code>my_data.ranges</code> refers to a variable length array defined by the <code>example_t</code> LCM type, and is represented by a pointer in the generated C struct. It is up to the programmer to set this pointer to an array of the proper type, and set <code>my_data.num_ranges</code> to a value smaller or equal to the number of elements in that array. When the message is encoded, <code>my_data.num_ranges</code> determines how many elements will actually be read and transmitted from <code>my_data.ranges</code>. If <code>my_data.num_ranges</code> is set to 0, the value of <code>my_data.ranges</code> is ignored.</p>
<p>The call to exlcm_example_t_publish() serializes the data into a byte stream and transmits the packet using LCM to any interested receivers. The string <code>"EXAMPLE"</code> is the <em>channel</em> name, which is a string transmitted with each packet that identifies the contents to receivers. Receivers subscribe to different channels using this identifier, allowing uninteresting data to be discarded quickly and efficiently.</p>
<h1><a class="anchor" id="tutorial_c_receive"></a>
Receiving LCM Messages</h1>
<p>As discussed above, each LCM message is transmitted with an attached channel name. You can use these channel names to determine which LCM messages your application receives, by subscribing to the channels of interest. It is important for senders and receivers to agree on the channel names which will be used for each message type.</p>
<p>Here is a sample program that sets up LCM and adds a subscription to the <code>"EXAMPLE"</code> channel. Whenever a message is received on this channel, its contents are printed out. If messages on other channels are being transmitted over the network, this program will not see them because it only has a subscription to the <code>"EXAMPLE"</code> channel. A particular instance of LCM may have an unlimited number of subscriptions.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;inttypes.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;lcm/lcm.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;exlcm_example_t.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">my_handler(<span class="keyword">const</span> lcm_recv_buf_t *rbuf, <span class="keyword">const</span> <span class="keywordtype">char</span> * channel, </div>
<div class="line">        <span class="keyword">const</span> exlcm_example_t * msg, <span class="keywordtype">void</span> * user)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    printf(<span class="stringliteral">&quot;Received message on channel \&quot;%s\&quot;:\n&quot;</span>, channel);</div>
<div class="line">    printf(<span class="stringliteral">&quot;  timestamp   = %&quot;</span>PRId64<span class="stringliteral">&quot;\n&quot;</span>, msg-&gt;timestamp);</div>
<div class="line">    printf(<span class="stringliteral">&quot;  position    = (%f, %f, %f)\n&quot;</span>,</div>
<div class="line">            msg-&gt;position[0], msg-&gt;position[1], msg-&gt;position[2]);</div>
<div class="line">    printf(<span class="stringliteral">&quot;  orientation = (%f, %f, %f, %f)\n&quot;</span>,</div>
<div class="line">            msg-&gt;orientation[0], msg-&gt;orientation[1], msg-&gt;orientation[2],</div>
<div class="line">            msg-&gt;orientation[3]);</div>
<div class="line">    printf(<span class="stringliteral">&quot;  ranges:&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span>(i = 0; i &lt; msg-&gt;num_ranges; i++)</div>
<div class="line">        printf(<span class="stringliteral">&quot; %d&quot;</span>, msg-&gt;ranges[i]);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;  name        = &#39;%s&#39;\n&quot;</span>, msg-&gt;name);</div>
<div class="line">    printf(<span class="stringliteral">&quot;  enabled     = %d\n&quot;</span>, msg-&gt;enabled);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__LcmC__lcm__t.html#gabb730c9e49442a4bcf400e0f2fef7576">lcm_t</a> * lcm = <a class="code" href="group__LcmC__lcm__t.html#gaf29963ef43edadf45296d5ad82c18d4b">lcm_create</a>(NULL);</div>
<div class="line">    <span class="keywordflow">if</span>(!lcm)</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line"></div>
<div class="line">    exlcm_example_t_subscribe(lcm, <span class="stringliteral">&quot;EXAMPLE&quot;</span>, &amp;my_handler, NULL);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span>(1)</div>
<div class="line">        <a class="code" href="group__LcmC__lcm__t.html#ga964c763e37b3c7f8af9ca37df381b10a">lcm_handle</a>(lcm);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__LcmC__lcm__t.html#ga4c86753e2e8c535bc8fb91d3763336e2">lcm_destroy</a>(lcm);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The full example is available in runnable form as <code>examples/c/listener.c</code> in the LCM source distribution.</p>
<p>A key design principal for this subscription code is that it is <em>event driven</em>. The application supplies a callback function to example_t_subscribe() that is called whenever a message is available. This happens inside a single thread without need for concurrency, since the callback is dispatched from within the <a class="el" href="group__LcmC__lcm__t.html#ga964c763e37b3c7f8af9ca37df381b10a" title="Wait for and dispatch the next incoming message. ">lcm_handle()</a> function.</p>
<p>It is important to call <a class="el" href="group__LcmC__lcm__t.html#ga964c763e37b3c7f8af9ca37df381b10a" title="Wait for and dispatch the next incoming message. ">lcm_handle()</a> whenever work needs to be done by LCM. If no work is needed, the function will block until there is. For applications without another type of main loop, it is suitable to call <a class="el" href="group__LcmC__lcm__t.html#ga964c763e37b3c7f8af9ca37df381b10a" title="Wait for and dispatch the next incoming message. ">lcm_handle()</a> in a loop as seen above. However, many applications already use some type of event loop. In these cases, it is best to monitor the LCM file descriptor, which can be obtained with <a class="el" href="group__LcmC__lcm__t.html#ga51bd65da2efbd1ef094cb36b4a906922" title="Returns a file descriptor or socket that can be used with select(), poll(), or other event loops for ...">lcm_get_fileno()</a>. Whenever this file descriptor becomes readable, the application should call <a class="el" href="group__LcmC__lcm__t.html#ga964c763e37b3c7f8af9ca37df381b10a" title="Wait for and dispatch the next incoming message. ">lcm_handle()</a> which is guaranteed to not block in such a situation. Additional examples for doing this can be found in <code>examples/c</code>, in the LCM source distribution. </p>
</div></div><!-- contents -->
<hr class="footer"/></body>
</html>
